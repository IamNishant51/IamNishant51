name: Chat with DeepSeek

# This makes the button appear in the "Actions" tab
on:
  workflow_dispatch:
    inputs:
      colab_url:
        description: 'PASTE your Colab ngrok URL here (e.g., https://xyz.ngrok-free.app)'
        required: true
      user_prompt:
        description: 'What do you want to ask the AI?'
        required: true
        default: 'Tell me a short story about a robot.'

jobs:
  call-ai:
    runs-on: ubuntu-latest
    steps:
      - name: Send Message to Colab
        run: |
          echo "ðŸ“¨ Sending your question to the AI..."
          
          # 1. Send the request silently (-s hides the weird numbers/progress bar)
          # 2. We capture the answer into a variable called 'response'
          response=$(curl -s -X POST "${{ inputs.colab_url }}/api/generate" \
          -H "Content-Type: application/json" \
          -d '{
            "model": "deepseek-r1:8b",
            "prompt": "${{ inputs.user_prompt }}",
            "stream": false
          }')
          
          # 3. Print the Answer cleanly
          echo "----------------------------------------"
          echo "âœ… AI ANSWER:"
          echo "----------------------------------------"
          
          # This tries to print just the answer text. 
          # If it fails, it prints the whole raw message so you don't lose anything.
          echo "$response" | jq -r '.response' || echo "$response"
          
          echo "----------------------------------------"
